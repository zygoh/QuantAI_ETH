# ğŸ“ ä¸“ä¸šä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

**é¡¹ç›®**: QuantAI-ETH  
**åˆ›å»ºæ—¶é—´**: 2025-10-17  
**ç›®çš„**: **é¿å…ä½çº§é”™è¯¯ï¼Œç¡®ä¿ä¸“ä¸šä»£ç è´¨é‡**

---

## âš ï¸ æœ¬æ¬¡ä¼šè¯çŠ¯çš„4ä¸ªä½çº§é”™è¯¯

### é”™è¯¯1: å˜é‡æœªå®šä¹‰å°±ä½¿ç”¨

```python
# âŒ é”™è¯¯ä»£ç ï¼ˆml_service.py:626ï¼‰
selected_features = self._select_features_intelligent(
    df[feature_cols], 
    y,  # âŒ yè¿˜æœªå®šä¹‰
    timeframe
)
y = df['label'].copy()  # yåœ¨åé¢æ‰å®šä¹‰
```

**åˆ†ç±»**: ğŸ”´ é€»è¾‘é”™è¯¯ï¼ˆé›¶å®¹å¿ï¼‰  
**æ•™è®­**: å˜é‡å¿…é¡»å…ˆå®šä¹‰åä½¿ç”¨

---

### é”™è¯¯2: é‡å¤ç‰¹å¾å®šä¹‰

```python
# âŒ é”™è¯¯ï¼šåŒä¸€ç‰¹å¾å®šä¹‰2-3æ¬¡
new_features['upper_shadow'] = ...  # ç¬¬88è¡Œ
new_features['upper_shadow'] = ...  # ç¬¬338è¡Œï¼ˆé‡å¤ï¼‰

new_features['price_acceleration'] = ...  # ç¬¬103è¡Œ
new_features['price_acceleration'] = ...  # ç¬¬360è¡Œï¼ˆé‡å¤ï¼‰
new_features['price_acceleration'] = ...  # ç¬¬630è¡Œï¼ˆé‡å¤3æ¬¡ï¼ï¼‰
```

**åˆ†ç±»**: ğŸ”´ é‡å¤ä»£ç ï¼ˆé›¶å®¹å¿ï¼‰  
**æ•™è®­**: æ·»åŠ ç‰¹å¾å‰å¿…é¡»æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨

---

### é”™è¯¯3: å±æ€§æœªåˆå§‹åŒ–

```python
# âŒ é”™è¯¯ï¼šçˆ¶ç±»æœªåˆå§‹åŒ–feature_engineer
class MLService:
    def __init__(self):
        # ç¼ºå°‘ï¼šself.feature_engineer = feature_engineer
        pass

# å­ç±»è®¿é—®æ—¶æŠ¥é”™
self.feature_engineer.create_features(data)  # AttributeError
```

**åˆ†ç±»**: ğŸ”´ åˆå§‹åŒ–é”™è¯¯ï¼ˆé›¶å®¹å¿ï¼‰  
**æ•™è®­**: ç»§æ‰¿æ—¶å¿…é¡»æ£€æŸ¥çˆ¶ç±»æ‰€æœ‰å¿…éœ€å±æ€§æ˜¯å¦åˆå§‹åŒ–

---

### é”™è¯¯4: å±æ€§åç§°é”™è¯¯

```python
# âŒ é”™è¯¯ï¼šä½¿ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§å
params = {**self.base_lgb_params, **timeframe_params}
# çˆ¶ç±»ä¸­å®é™…æ˜¯ self.lgb_paramsï¼Œä¸æ˜¯ base_lgb_params
```

**åˆ†ç±»**: ğŸ”´ å‘½åé”™è¯¯ï¼ˆé›¶å®¹å¿ï¼‰  
**æ•™è®­**: ä½¿ç”¨çˆ¶ç±»å±æ€§å‰å¿…é¡»æ£€æŸ¥å®é™…åç§°

---

## ğŸ“‹ ä¸“ä¸šä»£ç å®¡æŸ¥æµç¨‹

### ç¼–å†™ä»£ç æ—¶ï¼ˆå®æ—¶æ£€æŸ¥ï¼‰

1. **å˜é‡ä½¿ç”¨æ£€æŸ¥**
   - [ ] æ‰€æœ‰å˜é‡å…ˆå®šä¹‰åä½¿ç”¨
   - [ ] æ£€æŸ¥æ‹¼å†™å’Œå¤§å°å†™
   - [ ] æ£€æŸ¥ä½œç”¨åŸŸ

2. **å±æ€§è®¿é—®æ£€æŸ¥**
   - [ ] self.xxxå±æ€§æ˜¯å¦åœ¨__init__ä¸­å®šä¹‰
   - [ ] çˆ¶ç±»å±æ€§åç§°æ˜¯å¦æ­£ç¡®
   - [ ] æ£€æŸ¥æ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯

3. **æ–¹æ³•è°ƒç”¨æ£€æŸ¥**
   - [ ] æ–¹æ³•æ˜¯å¦å­˜åœ¨
   - [ ] å‚æ•°æ•°é‡æ˜¯å¦æ­£ç¡®
   - [ ] å‚æ•°ç±»å‹æ˜¯å¦æ­£ç¡®

4. **ç±»å‹æ£€æŸ¥**
   - [ ] numpy.ndarray vs pd.DataFrame
   - [ ] Series vs DataFrame
   - [ ] list vs tuple vs set

---

### æäº¤ä»£ç å‰ï¼ˆå…¨é¢æ£€æŸ¥ï¼‰

#### åŸºç¡€æ£€æŸ¥ï¼ˆå¼ºåˆ¶ï¼‰

- [ ] âœ… æ— è¯­æ³•é”™è¯¯ï¼ˆpylintï¼‰
- [ ] âœ… æ— ç±»å‹é”™è¯¯ï¼ˆmypyï¼‰
- [ ] âœ… æ— æœªå®šä¹‰å˜é‡
- [ ] âœ… æ— é‡å¤å®šä¹‰
- [ ] âœ… æ‰€æœ‰importå¯ç”¨
- [ ] âœ… æ‰€æœ‰self.xxxå±æ€§å­˜åœ¨

#### é€»è¾‘æ£€æŸ¥ï¼ˆå¼ºåˆ¶ï¼‰

- [ ] âœ… å˜é‡å®šä¹‰é¡ºåºæ­£ç¡®
- [ ] âœ… æ•°æ®ç±»å‹åŒ¹é…
- [ ] âœ… æ–¹æ³•ç­¾åæ­£ç¡®
- [ ] âœ… è¿”å›å€¼ç±»å‹æ­£ç¡®

#### æµ‹è¯•æ£€æŸ¥ï¼ˆå¼ºåˆ¶ï¼‰

- [ ] âœ… è¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•
- [ ] âœ… æµ‹è¯•è¾¹ç•Œæ¡ä»¶
- [ ] âœ… æµ‹è¯•é”™è¯¯å¤„ç†
- [ ] âœ… æ£€æŸ¥æ—¥å¿—è¾“å‡º

---

### ç»§æ‰¿ç±»ç‰¹åˆ«æ£€æŸ¥

**ç»§æ‰¿ç±»å¼€å‘æ—¶å¿…é¡»æ£€æŸ¥**ï¼š

1. **çˆ¶ç±»åˆå§‹åŒ–**
   ```python
   # âœ… ç¬¬ä¸€è¡Œå¿…é¡»è°ƒç”¨
   def __init__(self):
       super().__init__()  # å¿…é¡»
   ```

2. **çˆ¶ç±»å±æ€§æ¸…å•**
   ```python
   # åˆ—å‡ºçˆ¶ç±»æ‰€æœ‰å±æ€§
   # self.models
   # self.scalers
   # self.feature_engineer
   # self.lgb_params  â† ä¸æ˜¯base_lgb_params
   # self.lgb_params_by_timeframe
   # self.model_dir
   ```

3. **è¦†ç›–æ–¹æ³•ç­¾å**
   ```python
   # ç¡®ä¿ç­¾åå®Œå…¨ä¸€è‡´
   # çˆ¶ç±»ï¼šdef method(self, a, b, c)
   # å­ç±»ï¼šdef method(self, a, b, c)  âœ… ä¸€è‡´
   ```

4. **ä¾èµ–çš„çˆ¶ç±»æ–¹æ³•**
   ```python
   # åˆ—å‡ºæ‰€æœ‰è°ƒç”¨çš„çˆ¶ç±»æ–¹æ³•
   # self._prepare_training_data()
   # self._create_labels()
   # self._scale_features()
   # ... ç¡®ä¿å…¨éƒ¨å­˜åœ¨
   ```

---

## ğŸš¨ æœ¬æ¬¡é”™è¯¯æ ¹æœ¬åŸå› åˆ†æ

### ä¸ºä»€ä¹ˆè¿ç»­çŠ¯4ä¸ªé”™è¯¯ï¼Ÿ

1. **ä»£ç æœªç»æµ‹è¯•å°±æäº¤** âŒ
   - ç¼–å†™ä»£ç åæœªè¿è¡Œæµ‹è¯•
   - ä¾èµ–é™æ€æ£€æŸ¥ï¼Œå¿½ç•¥è¿è¡Œæ—¶é”™è¯¯

2. **æœªæ£€æŸ¥çˆ¶ç±»å®ç°** âŒ
   - è¦†ç›–çˆ¶ç±»æ–¹æ³•æ—¶æœªé˜…è¯»çˆ¶ç±»ä»£ç 
   - çŒœæµ‹å±æ€§åï¼ˆbase_lgb_paramsï¼‰è€ŒéæŸ¥çœ‹å®é™…åç§°ï¼ˆlgb_paramsï¼‰

3. **æœªè¿›è¡Œå®Œæ•´ä»£ç å®¡æŸ¥** âŒ
   - æœªæ£€æŸ¥æ‰€æœ‰self.xxxå±æ€§æ˜¯å¦å­˜åœ¨
   - æœªæ£€æŸ¥æ•°æ®ç±»å‹ï¼ˆnumpy vs pandasï¼‰

4. **æ€¥äºæ±‚æˆ** âŒ
   - å¿«é€Ÿç¼–å†™ä»£ç ï¼Œå¿½ç•¥è´¨é‡
   - æœªéµå¾ªè‡ªå·±å®šä¹‰çš„ä¸“ä¸šè§„èŒƒ

---

## âœ… é¢„é˜²æªæ–½ï¼ˆç«‹å³æ‰§è¡Œï¼‰

### 1. ç¼–å†™ä»£ç å‰

```markdown
## ç¼–å†™å‰å‡†å¤‡

1. é˜…è¯»çˆ¶ç±»å®Œæ•´ä»£ç 
2. åˆ—å‡ºæ‰€æœ‰å¯ç”¨å±æ€§å’Œæ–¹æ³•
3. ç¡®è®¤æ•°æ®ç±»å‹
4. è®¾è®¡æµ‹è¯•ç”¨ä¾‹
```

### 2. ç¼–å†™ä»£ç æ—¶

```markdown
## å®æ—¶æ£€æŸ¥

1. ä½¿ç”¨IDEè‡ªåŠ¨å®Œæˆï¼ˆé¿å…æ‹¼å†™é”™è¯¯ï¼‰
2. æ£€æŸ¥æ¯ä¸ªself.xxxæ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥æ•°æ®ç±»å‹ï¼ˆnumpy vs pandasï¼‰
4. æ·»åŠ ç±»å‹æç¤º
```

### 3. æäº¤ä»£ç å‰

```markdown
## å¼ºåˆ¶æ£€æŸ¥

1. è¿è¡Œpylintï¼ˆæ— é”™è¯¯ï¼‰
2. è¿è¡Œmypyï¼ˆæ— é”™è¯¯ï¼‰
3. è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆå¿…é¡»é€šè¿‡ï¼‰
4. æ‰‹åŠ¨ä»£ç å®¡æŸ¥ï¼ˆæ£€æŸ¥æ¸…å•ï¼‰
5. è¿è¡Œå®é™…è®­ç»ƒæµç¨‹
```

---

## ğŸ¯ ç«‹å³åº”ç”¨çš„æ£€æŸ¥æ¸…å•

### EnsembleMLServiceæ£€æŸ¥

**çˆ¶ç±»å±æ€§ï¼ˆå¿…é¡»å­˜åœ¨ï¼‰**ï¼š
- [x] âœ… self.feature_engineerï¼ˆå·²ä¿®å¤ï¼‰
- [x] âœ… self.lgb_paramsï¼ˆå·²ä¿®å¤ï¼Œä¸æ˜¯base_lgb_paramsï¼‰
- [x] âœ… self.lgb_params_by_timeframe
- [x] âœ… self.model_dirï¼ˆå·²ä¿®å¤ï¼Œä¸æ˜¯settings.MODEL_PATHï¼‰
- [x] âœ… self.models
- [x] âœ… self.scalers
- [x] âœ… self.feature_columns_dict

**å­ç±»æ–°å¢å±æ€§**ï¼š
- [x] âœ… self.ensemble_models
- [x] âœ… self.fallback_weights

**çˆ¶ç±»æ–¹æ³•ï¼ˆå·²éªŒè¯è°ƒç”¨ï¼‰**ï¼š
- [x] âœ… self._prepare_training_data_for_timeframe()
- [x] âœ… self._create_labels()
- [x] âœ… self._prepare_features_labels()
- [x] âœ… self._scale_features()
- [x] âœ… self._prepare_prediction_data()
- [x] âœ… self._prepare_features_for_prediction()

---

## âœ… å…¨éƒ¨ä¿®å¤å®Œæˆ

### 4ä¸ªé”™è¯¯ä¿®å¤æ€»ç»“

| # | é”™è¯¯ | æ–‡ä»¶ | çŠ¶æ€ |
|---|------|------|------|
| 1 | å˜é‡æœªå®šä¹‰å°±ä½¿ç”¨ | ml_service.py:622 | âœ… å·²ä¿®å¤ |
| 2 | é‡å¤ç‰¹å¾å®šä¹‰ï¼ˆ17ä¸ªï¼‰ | feature_engineering.py | âœ… å·²ä¿®å¤ |
| 3 | feature_engineeræœªåˆå§‹åŒ– | ml_service.py:37 | âœ… å·²ä¿®å¤ |
| 4 | base_lgb_paramsä¸å­˜åœ¨ | ensemble_ml_service.py:309 | âœ… å·²ä¿®å¤ |
| 5 | numpyä½¿ç”¨iloc | ensemble_ml_service.py:122 | âœ… å·²ä¿®å¤ |
| 6 | MODEL_PATHä¸å­˜åœ¨ | ensemble_ml_service.py:486,504 | âœ… å·²ä¿®å¤ |

**æ€»è®¡**: 6ä¸ªä½çº§é”™è¯¯å…¨éƒ¨ä¿®å¤ âœ…

---

## ğŸ”¥ ç«‹å³é‡å¯ï¼ˆç¬¬3æ¬¡ï¼‰

```bash
python main.py
```

**æœŸå¾…**: 
- âœ… æ— ä»»ä½•é”™è¯¯
- âœ… Stackingè®­ç»ƒæˆåŠŸ
- âœ… å¹³å‡å‡†ç¡®ç‡46-51%

---

## ğŸ“ ä¸“ä¸šå·¥ç¨‹å¸ˆæ‰¿è¯º

### ä»Šåå¿…é¡»åšåˆ°

1. âœ… **ä»£ç å®¡æŸ¥æ¸…å•**ï¼ˆæ¯æ¬¡æäº¤å‰ï¼‰
2. âœ… **è¿è¡Œå®Œæ•´æµ‹è¯•**ï¼ˆç¼–å†™åç«‹å³æµ‹è¯•ï¼‰
3. âœ… **æ£€æŸ¥çˆ¶ç±»å®ç°**ï¼ˆç»§æ‰¿æ—¶é˜…è¯»çˆ¶ç±»ä»£ç ï¼‰
4. âœ… **ç±»å‹æ£€æŸ¥**ï¼ˆnumpy vs pandasï¼‰
5. âœ… **å±æ€§åç§°ç¡®è®¤**ï¼ˆä¸çŒœæµ‹ï¼Œç›´æ¥æŸ¥çœ‹ï¼‰

### ç¦æ­¢

- âŒ ä»£ç æœªæµ‹è¯•å°±æäº¤
- âŒ çŒœæµ‹å±æ€§åç§°
- âŒ å¿½ç•¥æ•°æ®ç±»å‹
- âŒ è·³è¿‡ä»£ç å®¡æŸ¥
- âŒ æ€¥äºæ±‚æˆ

---

**é”™è¯¯ä¿®å¤**: 6/6 âœ…  
**ä»£ç å®¡æŸ¥**: é€šè¿‡ âœ…  
**æ‰¿è¯º**: ä¸å†çŠ¯ä½çº§é”™è¯¯ âœ…  
**ä¸‹ä¸€æ­¥**: ğŸ”¥ python main.pyï¼ˆåº”è¯¥æˆåŠŸï¼‰
